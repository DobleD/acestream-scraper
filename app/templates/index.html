<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acestream Scraper</title>
    <script>
        function refreshScraper() {
            fetch('/refresh', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    alert('Refresh initiated. Last refresh date: ' + data.last_refresh_date);
                    // Optionally, you can reload the page to update the displayed data
                    location.reload();
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>Acestream Scraper</h1>
    <button onclick="refreshScraper()">Force Refresh</button>
    <h2>Scraped URLs:</h2>
    <ul>
        {% for url in urls %}
            <li>{{ url.url }} - Status: {{ url.status }} - Last Processed: {{ url.last_processed }}</li>
        {% endfor %}
    </ul>
    <form method="POST">
        <label for="new_url">Add URL:</label>
        <input type="text" id="new_url" name="new_url">
        <button type="submit">Add</button>
    </form>
    <h2>Metadata:</h2>
    <p>Last Refresh Date: {{ last_refresh_date }}</p>
    <p>Previous Item Count: {{ last_item_count }}</p>
    <p>Current Item Count: {{ current_item_count }}</p>
    <h2>Acestream Channels:</h2>
    <ul>
        {% for channel in channels %}
            <li>{{ channel.name }} (ID: {{ channel.id }}) - Last Processed: {{ channel.last_processed }}</li>
        {% endfor %}
    </ul>
    <h2>Links:</h2>
    <p><a href="/list.m3u" target="_blank">Download M3U Playlist</a></p>
</body>
</html>
